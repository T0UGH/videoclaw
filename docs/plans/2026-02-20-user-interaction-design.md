# 用户交互增强设计

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:writing-plans to implement this plan.

**Goal:** 增加视频创建流程中的用户交互环节，让用户在关键步骤可以审查、调整和确认生成内容

**Architecture:** 在现有 pipeline 中增加三个交互点：Analyze 阶段的 AI 追问、Assets/Storyboard 阶段的生成确认与提示词优化、多图选择

---

## 1. Analyze 阶段 - AI 主动追问

### 目标
用户给出一个粗略的视频想法后，AI 主动追问以获取更详细的需求

### 交互流程
1. 用户输入视频想法（如 "帮我做个宇航员在火星发现变形金刚的视频"）
2. AI 追问关键问题，一次只问一个，使用 AskUserQuestion
3. 追问示例：
   - "这个视频想表达什么氛围？"（紧张/有趣/史诗感）
   - "大概多长时间？"（15秒/30秒/1分钟）
   - "需要几个主要角色？"
4. 追问完后确认："我理解你要做一个30秒、有史诗感的视频，有宇航员和变形金刚两个角色。我这样理解对吗？"
5. 用户确认后生成最终的 JSON 分镜

### 实现位置
- 修改 `video-create` skill，在调用 analyze 步骤时改为交互式

---

## 2. Assets 阶段 - 生成确认与提示词优化

### 目标
每个角色/场景生成后，让用户确认，可以调整提示词后重新生成

### 交互流程
每个角色/场景生成后：
1. 显示生成完成的本地路径
2. AskUserQuestion: "这个可以吗？**A** 继续 / **B** 需要调整"
3. 如果选 A → 下一个元素
4. 如果选 B → 问："哪里需要调整？"（开放式问题）
5. 根据用户反馈调整提示词，重新生成
6. 重复直到用户确认

### 本地图片支持
- **自动检测**：目录有图片就直接用，没有才调用 T2I
- **CLI选项**：`--use-local` 强制用本地图片
- **检测到多张时**：AskUserQuestion 让用户选择

### 多图生成
- **配置文件**：`assets.variants: 3` 设置默认生成数量
- **运行时询问**：AskUserQuestion 问用户生成几张
- **选择方式**：生成完后让用户选一张

---

## 3. Storyboard 阶段 - 生成确认与提示词优化

### 目标
每帧故事板生成后，让用户确认，可以调整提示词后重新生成

### 交互流程
每帧生成后：
1. 显示生成完成的本地路径
2. AskUserQuestion: "这帧可以吗？**A** 继续 / **B** 需要调整"
3. 如果选 A → 下一帧
4. 如果选 B → 问："哪里需要调整？"（开放式问题）
5. 根据用户反馈调整提示词，重新生成
6. 重复直到用户确认

### 多图生成
- **配置文件**：`storyboard.variants: 3` 设置默认生成数量
- **运行时询问**：AskUserQuestion 问用户生成几张
- **选择方式**：生成完后让用户选一张

---

## 4. 配置选项

新增配置项（`config.yaml`）：

```yaml
# 资产生成选项
assets:
  variants: 3  # 默认生成数量，0 表示不启用多图
  auto_use_local: true  # 自动检测本地图片

# 故事板生成选项
storyboard:
  variants: 3  # 默认生成数量
```

---

## 5. 技术实现要点

### AskUserQuestion 使用
- 确认类问题用固定选项（A/B）
- 调整类问题用开放式，让用户自己说
- 不要给太多固定选项

### 提示词优化流程
1. 用户说哪里不好（如"眼睛太小"）
2. 我追问细节（如"要大到什么程度？"）
3. 根据反馈修改提示词
4. 重新生成

### 状态管理
- 每个元素生成后更新 state
- 用户确认后才标记为完成
- 允许跳过交互（通过 CLI flag）

---

## 6. 待确认问题

- [x] Analyze 阶段使用 AI 主动追问
- [x] Assets/Storyboard 阶段生成后确认
- [x] 支持提示词优化（开放式反馈）
- [x] 本地图片支持
- [x] 多图生成选择
- [ ] I2V 视频生成是否也需要确认？
